# AIDE configuration for Cloud Infrastructure Platform
# File integrity monitoring configuration

# Database paths
database=file:/var/lib/aide/aide.db
database_out=file:/var/lib/aide/aide.db.new

# Report settings
report_url=stdout
report_url=file:/var/log/aide/aide.log

# Verbose level
verbose=5

# Regular expression patterns
Bindir = /bin
Sbindir = /sbin
Confdir = /etc

# Rules
# R = p+i+l+n+u+g+s+m+c+md5
# L = p+i+l+n+u+g
# > = growing log file p+u+g+i+n+S
# p = permissions
# i = inode
# n = number of links
# u = user
# g = group
# s = size
# b = block count
# m = mtime
# a = atime
# c = ctime
# S = check for growing size
# md5 = md5 checksum
# sha1 = sha1 checksum
# sha256 = sha256 checksum
# sha512 = sha512 checksum
# rmd160 = rmd160 checksum
# tiger = tiger checksum

# Rule definitions
NORMAL = R+sha256
PERMS = p+i+u+g
LOGS = >
LSPP = R+sha256
DATAONLY = sha256

# Directories to monitor
/boot       NORMAL
/bin        NORMAL
/sbin       NORMAL
/usr/bin    NORMAL
/usr/sbin   NORMAL
/usr/local/bin NORMAL
/usr/local/sbin NORMAL
/etc        NORMAL
/lib        NORMAL
/lib64      NORMAL

# Cloud Platform specific files
/opt/cloud-platform/deployment/security NORMAL
/opt/cloud-platform/app.py NORMAL
/opt/cloud-platform/config.py NORMAL
/opt/cloud-platform/requirements.txt NORMAL
/opt/cloud-platform/core NORMAL
/opt/cloud-platform/models NORMAL
/opt/cloud-platform/api NORMAL
/opt/cloud-platform/blueprints NORMAL
/opt/cloud-platform/services NORMAL
/opt/cloud-platform/cli NORMAL
/opt/cloud-platform/scripts NORMAL
/var/www/cloud-platform NORMAL
/etc/nginx/sites-enabled NORMAL

# Logs - just check permissions, not content
/var/log   PERMS
!/var/log/.*\\.gz
!/var/log/.*\\.[0-9]
!/var/log/.*\\.log
!/var/log/lastlog
/var/log/aide.log LOGS

# Temp directories - exclude from checking
!/tmp
!/var/tmp
!/var/run
!/var/cache
!/var/spool
!/var/lock

# Cloud Platform specific exclusions
!/opt/cloud-platform/instance
!/opt/cloud-platform/uploads
!/opt/cloud-platform/logs
!/opt/cloud-platform/.env
!/opt/cloud-platform/venv
!/opt/cloud-platform/__pycache__

# Database files - only check permissions to avoid false positives due to regular changes
/var/lib/postgresql/data   PERMS

# ICS specific monitoring
/opt/cloud-platform/ics NORMAL
/etc/cloud-platform/ics-config NORMAL

# Security-related files that should be monitored with extra scrutiny
/opt/cloud-platform/deployment/security/certs LSPP
/opt/cloud-platform/deployment/security/keys LSPP
/etc/ssl/private LSPP
/etc/ssl/certs NORMAL

# Additional system directories to monitor
/boot/grub NORMAL
/etc/cron.d NORMAL
/etc/cron.daily NORMAL
/etc/cron.hourly NORMAL
/etc/cron.weekly NORMAL
/etc/cron.monthly NORMAL
/etc/sudoers NORMAL
/etc/sudoers.d NORMAL

# System users and groups
/etc/passwd NORMAL
/etc/shadow LSPP
/etc/group NORMAL
/etc/gshadow LSPP

# Additional configuration files
/etc/ssh/sshd_config NORMAL
/etc/cloud-platform/security NORMAL
/etc/nginx/nginx.conf NORMAL
/etc/nginx/conf.d NORMAL
/etc/nginx/sites-available NORMAL
/etc/fail2ban NORMAL
/etc/sysctl.conf NORMAL
/etc/sysctl.d NORMAL
/etc/security NORMAL

# Runtime configuration checks
/etc/hosts NORMAL
/etc/hosts.allow NORMAL
/etc/hosts.deny NORMAL
/etc/resolv.conf NORMAL

# Firewall rules
/etc/iptables NORMAL
/etc/firewalld NORMAL

# Monitor binary files only for permission changes and checksums
/bin PERMS+DATAONLY
/sbin PERMS+DATAONLY
/usr/bin PERMS+DATAONLY
/usr/sbin PERMS+DATAONLY

# Exclude version control directories
!/opt/cloud-platform/.git
!/opt/cloud-platform/*/.git
!/var/www/cloud-platform/.git

# Exclude development files that change frequently
!/opt/cloud-platform/*.pyc
!/opt/cloud-platform/tests
!/opt/cloud-platform/docs/build

# Exclude application-generated temporary files
!/opt/cloud-platform/instance/temp
!/opt/cloud-platform/instance/cache
!/var/www/cloud-platform/static/generated
!/var/www/cloud-platform/media/uploads

# Exclude log files that are rotated regularly
!/var/log/cloud-platform/access.log*
!/var/log/cloud-platform/error.log*
!/var/log/cloud-platform/app.log*
!/var/log/nginx/*.log*

# Container-specific exclusions
!/var/lib/docker
!/var/lib/containerd

# Backup files
!/var/backups

# Monitoring files that change regularly
!/var/lib/prometheus
!/var/lib/grafana

# Application database files that change regularly
!/opt/cloud-platform/instance/db.sqlite
